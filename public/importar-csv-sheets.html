<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Importar CSV a Google Sheets - Alberto Ochoa</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .import-container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .preview-table {
      width: 100%;
      border-collapse: collapse;
      margin: 2rem 0;
      font-size: 0.9rem;
    }
    .preview-table th,
    .preview-table td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: left;
    }
    .preview-table th {
      background: #dc143c;
      color: white;
      font-weight: bold;
    }
    .preview-table tr:nth-child(even) {
      background: #f9f9f9;
    }
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      margin-right: 1rem;
      transition: background 0.3s;
    }
    .btn-primary {
      background: #dc143c;
      color: white;
    }
    .btn-primary:hover {
      background: #b01030;
    }
    .status {
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
      display: none;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
  </style>
</head>
<body>
  <div class="import-container">
    <h1>üì§ Importar Datos del CSV a Google Sheets</h1>
    <p>Se importar√°n <strong>11 veh√≠culos</strong> actualizados directamente a Google Sheets.</p>

    <div id="preview"></div>

    <button class="btn btn-primary" onclick="importarASheets()">üìä Importar a Google Sheets</button>
    <button class="btn" onclick="window.location.href='index.html'">‚Üê Volver</button>

    <div id="status" class="status"></div>
  </div>

  <script src="google-apps-script.js"></script>
  <script>
    // Datos del CSV convertidos a formato del sistema
    const datosCSV = [
      {
        id: 1,
        numero_vehiculo: '10183',
        estado: 'REPARACI√ìN',
        descripcion: 'Recalentamiento, consumo de refrigerante',
        tecnico_asignado: null,
        taller_asignado: 'Mec√°nica',
        diagnostico: 'Prueba de ruta',
        analisis: 'En seguimiento',
        requiere_reparacion: null,
        notas: 'Seguimiento de consumo (posible bajada de culata)',
        prueba_ruta: true,
        fecha_reporte: new Date(Date.now() - 172800000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 2,
        numero_vehiculo: '2996',
        estado: 'TALLER',
        descripcion: 'Vidrio de puerta quebrado',
        tecnico_asignado: 'Sin asignar',
        taller_asignado: 'AGA',
        diagnostico: 'Cambio de vidrio',
        analisis: null,
        requiere_reparacion: null,
        notas: 'Cambiar Vidrio',
        prueba_ruta: false,
        fecha_reporte: new Date(Date.now() - 86400000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 3,
        numero_vehiculo: '2977',
        estado: 'AN√ÅLISIS',
        descripcion: 'Fuga de aceite',
        tecnico_asignado: 'Sin asignar',
        taller_asignado: 'DIOMEDEZ',
        diagnostico: 'Sin asignar',
        analisis: 'Pendiente',
        requiere_reparacion: null,
        notas: 'N/A',
        prueba_ruta: false,
        fecha_reporte: new Date(Date.now() - 259200000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 4,
        numero_vehiculo: '4418',
        estado: 'AN√ÅLISIS',
        descripcion: 'Perdida de fuerza',
        tecnico_asignado: 'Sin asignar',
        taller_asignado: 'Mec√°nica',
        diagnostico: 'Sin asignar',
        analisis: 'Pendiente',
        requiere_reparacion: null,
        notas: 'N/A',
        prueba_ruta: false,
        fecha_reporte: new Date(Date.now() - 345600000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 5,
        numero_vehiculo: '4626',
        estado: 'AN√ÅLISIS',
        descripcion: 'Vibraci√≥n',
        tecnico_asignado: 'MATEO GARCIA',
        taller_asignado: 'Pendiente',
        diagnostico: 'Sin asignar',
        analisis: 'Pendiente',
        requiere_reparacion: null,
        notas: 'Prueba de ruta',
        prueba_ruta: true,
        fecha_reporte: new Date(Date.now() - 432000000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 6,
        numero_vehiculo: '10167',
        estado: 'TALLER',
        descripcion: 'Filtraci√≥n de agua',
        tecnico_asignado: 'JUAN CARLOS GALLEGO',
        taller_asignado: 'Ricardo',
        diagnostico: 'Ensikada de capacete',
        analisis: null,
        requiere_reparacion: null,
        notas: 'Llamar a neider al medio dia',
        prueba_ruta: false,
        fecha_reporte: new Date(Date.now() - 518400000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 7,
        numero_vehiculo: '10160',
        estado: 'TALLER',
        descripcion: 'Revisi√≥n presi√≥n sistema de combustible',
        tecnico_asignado: 'JUAN CARLOS GALLEGO',
        taller_asignado: 'Sandro',
        diagnostico: 'Cambio tapa carcaza filtro principal, cambio filtro interno trampa de combustible',
        analisis: null,
        requiere_reparacion: null,
        notas: 'Consecuci√≥n de tapa por parte del almacen',
        prueba_ruta: false,
        fecha_reporte: new Date(Date.now() - 604800000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 8,
        numero_vehiculo: '10162',
        estado: 'TALLER',
        descripcion: 'Very very en direcci√≥n',
        tecnico_asignado: 'JUAN CARLOS GALLEGO',
        taller_asignado: 'Pablo Gomez',
        diagnostico: 'Pendiente',
        analisis: null,
        requiere_reparacion: null,
        notas: 'Ajustar barras de direcci√≥n, suspensi√≥n delantera, cambio de bujes barra transversal, cambio de bujes amortiguador delantero lado derecho y cambio de radiador',
        prueba_ruta: true,
        fecha_reporte: new Date(Date.now() - 691200000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 9,
        numero_vehiculo: '60105',
        estado: 'DIAGN√ìSTICO',
        descripcion: 'Bujadera',
        tecnico_asignado: 'MATEO GARCIA',
        taller_asignado: 'Raul precoltur',
        diagnostico: 'CITA MA√ëANA 7AM',
        analisis: 'En espera de diagn√≥stico',
        requiere_reparacion: null,
        notas: 'En espera de diagn√≥stico',
        prueba_ruta: true,
        fecha_reporte: new Date(Date.now() - 777600000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 10,
        numero_vehiculo: '10200',
        estado: 'TALLER',
        descripcion: 'Se encuentra habilitado hasta el momento',
        tecnico_asignado: 'JORGE ACOSTA, JUAN CARLOS GALLEGO, MATEO GARCIA',
        taller_asignado: 'Scania',
        diagnostico: 'En espera del cilindro longitudinal',
        analisis: null,
        requiere_reparacion: null,
        notas: 'En espera del cilindro longitudinal',
        prueba_ruta: false,
        fecha_reporte: new Date(Date.now() - 864000000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      },
      {
        id: 11,
        numero_vehiculo: '10199',
        estado: 'TALLER',
        descripcion: 'Se encuentra habilitado hasta el momento',
        tecnico_asignado: 'JORGE ACOSTA, JUAN CARLOS GALLEGO, MATEO GARCIA',
        taller_asignado: 'Scania',
        diagnostico: 'En espera de conector modulo tablero',
        analisis: null,
        requiere_reparacion: null,
        notas: 'En espera de conector modulo tablero',
        prueba_ruta: false,
        fecha_reporte: new Date(Date.now() - 950400000).toISOString(),
        fecha_actualizacion: new Date().toISOString()
      }
    ];

    // Mostrar preview
    window.addEventListener('DOMContentLoaded', () => {
      const preview = document.getElementById('preview');
      preview.innerHTML = `
        <h3>Vista previa de los datos (${datosCSV.length} veh√≠culos)</h3>
        <table class="preview-table">
          <thead>
            <tr>
              <th>N¬∫ Veh√≠culo</th>
              <th>Reporte</th>
              <th>Estado</th>
              <th>Taller</th>
              <th>T√©cnico</th>
              <th>Prueba Ruta</th>
            </tr>
          </thead>
          <tbody>
            ${datosCSV.map(v => `
              <tr>
                <td><strong>${v.numero_vehiculo}</strong></td>
                <td>${v.descripcion}</td>
                <td><span class="badge badge-${v.estado.toLowerCase()}">${v.estado}</span></td>
                <td>${v.taller_asignado || '-'}</td>
                <td>${v.tecnico_asignado || '-'}</td>
                <td>${v.prueba_ruta ? '‚úÖ SI' : '‚ùå NO'}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    });

    async function importarASheets() {
      const statusDiv = document.getElementById('status');
      
      // Verificar configuraci√≥n
      if (!googleSheets.isConfigured()) {
        mostrarEstado('error', '‚ùå Primero debes configurar Google Sheets.\nVe a ‚öôÔ∏è Google Sheets en el men√∫ principal.');
        return;
      }

      mostrarEstado('', 'üì§ Importando datos a Google Sheets...');

      try {
        // Guardar en localStorage primero
        localStorage.setItem('gestion_taller_reportes', JSON.stringify(datosCSV));
        
        // Guardar en Google Sheets
        const resultado = await googleSheets.guardarReportes(datosCSV);
        
        if (resultado) {
          mostrarEstado('success', `‚úÖ Importaci√≥n exitosa!\n\n${datosCSV.length} veh√≠culos importados a Google Sheets.\n\nAhora puedes:\n1. Ver los datos en tu Google Sheet\n2. Abrir el sistema principal\n3. Ver el dashboard TV`);
        } else {
          mostrarEstado('error', '‚ö†Ô∏è Los datos se guardaron en localStorage pero hubo un problema al sincronizar con Google Sheets.\nRevisa la configuraci√≥n.');
        }
      } catch (error) {
        mostrarEstado('error', `‚ùå Error al importar: ${error.message}`);
      }
    }

    function mostrarEstado(tipo, mensaje) {
      const status = document.getElementById('status');
      status.className = `status ${tipo}`;
      status.textContent = mensaje;
      status.style.display = 'block';
      status.style.whiteSpace = 'pre-line';
    }
  </script>
</body>
</html>
